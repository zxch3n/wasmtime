<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wasmtime: wasmtime.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Wasmtime
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('wasmtime_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">wasmtime.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Wasmtime's C API.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="wasi_8h_source.html">wasi.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="config_8h_source.html">wasmtime/config.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="engine_8h_source.html">wasmtime/engine.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="error_8h_source.html">wasmtime/error.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="extern_8h_source.html">wasmtime/extern.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="func_8h_source.html">wasmtime/func.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="global_8h_source.html">wasmtime/global.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="instance_8h_source.html">wasmtime/instance.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="linker_8h_source.html">wasmtime/linker.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="memory_8h_source.html">wasmtime/memory.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="module_8h_source.html">wasmtime/module.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="store_8h_source.html">wasmtime/store.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="table_8h_source.html">wasmtime/table.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="trap_8h_source.html">wasmtime/trap.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="val_8h_source.html">wasmtime/val.h</a>&gt;</code><br />
</div>
<p><a href="wasmtime_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af249de0b85489a54e725a27fbdd44629"><td class="memItemLeft" align="right" valign="top"><a class="el" href="error_8h.html#a6df4cddb88cff2bfdeecf8bba560af2c">wasmtime_error_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="wasmtime_8h.html#af249de0b85489a54e725a27fbdd44629">wasmtime_wat2wasm</a> (const char *wat, size_t wat_len, <a class="el" href="structwasm__byte__vec__t.html">wasm_byte_vec_t</a> *ret)</td></tr>
<tr class="memdesc:af249de0b85489a54e725a27fbdd44629"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts from the text format of WebAssembly to to the binary format.  <a href="wasmtime_8h.html#af249de0b85489a54e725a27fbdd44629">More...</a><br /></td></tr>
<tr class="separator:af249de0b85489a54e725a27fbdd44629"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Wasmtime's C API. </p>
<p >This file is the central inclusion point for Wasmtime's C API. There are a number of sub-header files but this file includes them all. The C API is based on <a class="el" href="wasm_8h.html">wasm.h</a> but there are many Wasmtime-specific APIs which are tailored to Wasmtime's implementation.</p>
<p >The <a class="el" href="structwasm__config__t.html" title="Global engine configuration.">wasm_config_t</a> and <a class="el" href="structwasm__engine__t.html" title="Compilation environment and configuration.">wasm_engine_t</a> types are used from <a class="el" href="wasm_8h.html">wasm.h</a>. Additionally all type-level information (like <a class="el" href="structwasm__functype__t.html" title="An opaque object representing the type of a function.">wasm_functype_t</a>) is also used from <a class="el" href="wasm_8h.html">wasm.h</a>. Otherwise, though, all wasm objects (like <a class="el" href="store_8h.html#a173db46be4eb6fbb452b1bb2140dadad" title="Convenience alias for wasmtime_store_t.">wasmtime_store_t</a> or <a class="el" href="extern_8h.html#ac3661fabd7972df1ade869f17de29dc5" title="Representation of a function in Wasmtime.">wasmtime_func_t</a>) are used from this header file.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Thread Safety</h3>
<p >The multithreading story of the C API very closely follows the multithreading story of the Rust API for Wasmtime. All objects are safe to send to other threads so long as user-specific data is also safe to send to other threads. Functions are safe to call from any thread but some functions cannot be called concurrently. For example, functions which correspond to <code>&amp;T</code> in Rust can be called concurrently with any other methods that take <code>&amp;T</code>. Functions that take <code>&amp;mut T</code> in Rust, however, cannot be called concurrently with any other function (but can still be invoked on any thread).</p>
<p >This generally equates to mutation of internal state. Functions which don't mutate anything, such as learning type information through <a class="el" href="func_8h.html#afb722801d65a87ac4743541624354928" title="Returns the type of the function specified.">wasmtime_func_type</a>, can be called concurrently. Functions which do require mutation, for example <a class="el" href="func_8h.html#a40e120dae88e66151e24e55194dc8dba" title="Call a WebAssembly function.">wasmtime_func_call</a>, cannot be called concurrently. This is conveyed in the C API with either <code>const wasmtime_context_t*</code> (concurrency is ok as it's read-only) or <code>wasmtime_context_t*</code> (concurrency is not ok, mutation may happen).</p>
<p >When in doubt assume that functions cannot be called concurrently with aliasing objects.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Aliasing</h3>
<p >The C API for Wasmtime is intended to be a relatively thin layer over the Rust API for Wasmtime. Rust has much more strict rules about aliasing than C does, and the Rust API for Wasmtime is designed around these rules to be used safely. These same rules must be upheld when using the C API of Wasmtime.</p>
<p >The main consequence of this is that the <a class="el" href="store_8h.html#a98d503c153853bb098689a122109de81" title="Convenience alias for wasmtime_context.">wasmtime_context_t</a> pointer into the <a class="el" href="store_8h.html#a173db46be4eb6fbb452b1bb2140dadad" title="Convenience alias for wasmtime_store_t.">wasmtime_store_t</a> must be carefully used. Since the context is an internal pointer into the store it must be used carefully to ensure you're not doing something that Rust would otherwise forbid at compile time. A <a class="el" href="store_8h.html#a98d503c153853bb098689a122109de81" title="Convenience alias for wasmtime_context.">wasmtime_context_t</a> can only be used when you would otherwise have been provided access to it. For example in a host function created with <a class="el" href="func_8h.html#a7b9dd547669d807c226857f2613c8ff5" title="Creates a new host-defined function.">wasmtime_func_new</a> you can use <a class="el" href="store_8h.html#a98d503c153853bb098689a122109de81" title="Convenience alias for wasmtime_context.">wasmtime_context_t</a> in the host function callback. This is because an argument, a <a class="el" href="func_8h.html#abad1840db69084f226feec107cc23d5e" title="Alias to wasmtime_caller.">wasmtime_caller_t</a>, provides access to <a class="el" href="store_8h.html#a98d503c153853bb098689a122109de81" title="Convenience alias for wasmtime_context.">wasmtime_context_t</a>. On the other hand a destructor passed to <a class="el" href="val_8h.html#a7e0f1ff895edd3eee5be0ee08ba1d9d8" title="Create a new externref value.">wasmtime_externref_new</a>, however, cannot use a <a class="el" href="store_8h.html#a98d503c153853bb098689a122109de81" title="Convenience alias for wasmtime_context.">wasmtime_context_t</a> because it was not provided access to one. Doing so may lead to memory unsafety.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Stores</h3>
<p >A foundational construct in this API is the <a class="el" href="store_8h.html#a173db46be4eb6fbb452b1bb2140dadad" title="Convenience alias for wasmtime_store_t.">wasmtime_store_t</a>. A store is a collection of host-provided objects and instantiated wasm modules. Stores are often treated as a "single unit" and items within a store are all allowed to reference one another. References across stores cannot currently be created. For example you cannot pass a function from one store into another store.</p>
<p >A store is not intended to be a global long-lived object. Stores provide no means of internal garbage collections of wasm objects (such as instances), meaning that no memory from a store will be deallocated until you call <a class="el" href="store_8h.html#ac8d51fd98a3c469b3afadc35b31c9bdd" title="Deletes a store.">wasmtime_store_delete</a>. If you're working with a web server, for example, then it's recommended to think of a store as a "one per request" sort of construct. Globally you'd have one <a class="el" href="structwasm__engine__t.html" title="Compilation environment and configuration.">wasm_engine_t</a> and a cache of <a class="el" href="module_8h.html#a3eb01c0fedee86fea2a4244a702eb107" title="Convenience alias for wasmtime_module.">wasmtime_module_t</a> instances compiled into that engine. Each request would create a new <a class="el" href="store_8h.html#a173db46be4eb6fbb452b1bb2140dadad" title="Convenience alias for wasmtime_store_t.">wasmtime_store_t</a> and then instantiate a <a class="el" href="module_8h.html#a3eb01c0fedee86fea2a4244a702eb107" title="Convenience alias for wasmtime_module.">wasmtime_module_t</a> into the store. This process of creating a store and instantiating a module is expected to be quite fast. When the request is finished you'd delete the <a class="el" href="store_8h.html#a173db46be4eb6fbb452b1bb2140dadad" title="Convenience alias for wasmtime_store_t.">wasmtime_store_t</a> keeping memory usage reasonable for the lifetime of the server. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af249de0b85489a54e725a27fbdd44629" name="af249de0b85489a54e725a27fbdd44629"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af249de0b85489a54e725a27fbdd44629">&#9670;&nbsp;</a></span>wasmtime_wat2wasm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="error_8h.html#a6df4cddb88cff2bfdeecf8bba560af2c">wasmtime_error_t</a> * wasmtime_wat2wasm </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>wat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>wat_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwasm__byte__vec__t.html">wasm_byte_vec_t</a> *&#160;</td>
          <td class="paramname"><em>ret</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts from the text format of WebAssembly to to the binary format. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wat</td><td>this it the input pointer with the WebAssembly Text Format inside of it. This will be parsed and converted to the binary format. </td></tr>
    <tr><td class="paramname">wat_len</td><td>this it the length of <code>wat</code>, in bytes. </td></tr>
    <tr><td class="paramname">ret</td><td>if the conversion is successful, this byte vector is filled in with the WebAssembly binary format.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a non-null error if parsing fails, or returns <code>NULL</code>. If parsing fails then <code>ret</code> isn't touched.</dd></dl>
<p>This function does not take ownership of <code>wat</code>, and the caller is expected to deallocate the returned <a class="el" href="error_8h.html#a6df4cddb88cff2bfdeecf8bba560af2c" title="Convenience alias for wasmtime_error.">wasmtime_error_t</a> and <a class="el" href="structwasm__byte__vec__t.html" title="A list of bytes.">wasm_byte_vec_t</a>. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="wasmtime_8h.html">wasmtime.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
